# 目标与计划（index-tts）

- 统一 BigVGAN 实现
  - [Priority] 高
  - [Implementation Difficulty] 中
  - [Feasibility/Necessity] 必要（减少重复维护/潜在分叉）
  - [Alternative Plan] 保留两份实现，仅出一个门面适配层
  - [Status] [未实现]
  - 动作：抽象 `BigVGANGenerator(h)`，迁移 `_from_pretrained/_save_pretrained`，替换全局 import。

- 向量化 padding（文本/梅尔）
  - [Priority] 高
  - [Implementation Difficulty] 低
  - [Feasibility/Necessity] 必要（显著降耗）
  - [Alternative Plan] 仅在推理路径向量化
  - [Status] [未实现]
  - 动作：改写 `set_mel_padding/set_text_padding`，单测覆盖极端长度。

- 生成内存峰值优化（cached_mel_emb）
  - [Priority] 中
  - [Implementation Difficulty] 中
  - [Feasibility/Necessity] 建议
  - [Alternative Plan] 分块 generate
  - [Status] [未实现]
  - 动作：在 `prepare_gpt_inputs` 阶段完成批对齐；移除 forward 内 `repeat_interleave`。

- FlashAttention / SDPA 接入
  - [Priority] 中
  - [Implementation Difficulty] 中
  - [Feasibility/Necessity] 依赖硬件/版本
  - [Alternative Plan] 仅使用 SDPA (`scaled_dot_product_attention`)
  - [Status] [未实现]
  - 动作：评估 HF 版本兼容；提供开关配置。

- VQ 最近邻加速（FAISS/分块）
  - [Priority] 中
  - [Implementation Difficulty] 中
  - [Feasibility/Necessity] 可选
  - [Alternative Plan] 降低 codebook 规模/分层 codebook
  - [Status] [未实现]
  - 动作：封装最近邻模块；提供 CPU/GPU 两套后端。

- 转置/permute 最小化
  - [Priority] 低
  - [Implementation Difficulty] 中
  - [Feasibility/Necessity] 建议
  - [Alternative Plan] 保持现状
  - [Status] [未实现]
  - 动作：统一 `(B,C,T)` 规范，边界转换；性能基准对比。
